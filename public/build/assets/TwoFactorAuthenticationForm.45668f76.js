import{u as Q,r as i,a as r,j as e,h,W as j,O as D}from"./app.293a78a2.js";import{c as y}from"./index.0579b088.js";import{A as L}from"./ActionSection.ca3d2e8b.js";import{D as T}from"./DialogModal.25c13a50.js";import{I}from"./InputError.68b75152.js";import{P as F}from"./PrimaryButton.9495eb81.js";import{T as _}from"./TextInput.acc7a464.js";import{S as C}from"./SecondaryButton.6c338189.js";import{D as Y}from"./DangerButton.c50c9ef8.js";import{I as q}from"./InputLabel.8542de9e.js";import{u as H}from"./useTypedPage.35d8ff85.js";import"./SectionTitle.713e09e5.js";import"./transition.b3d540a8.js";import"./use-root-containers.dc5aea37.js";function m({title:b="Confirm Password",content:N="For your security, please confirm your password to continue.",button:c="Confirm",onConfirm:p,children:l}){const f=Q(),[x,g]=i.exports.useState(!1),[o,d]=i.exports.useState({password:"",error:"",processing:!1}),t=i.exports.useRef(null);function w(){h.get(f("password.confirmation")).then(n=>{n.data.confirmed?p():(g(!0),setTimeout(()=>{var s;return(s=t.current)==null?void 0:s.focus()},250))})}function v(){d({...o,processing:!0}),h.post(f("password.confirm"),{password:o.password}).then(()=>{u(),setTimeout(()=>p(),250)}).catch(n=>{var s;d({...o,processing:!1,error:n.response.data.errors.password[0]}),(s=t.current)==null||s.focus()})}function u(){g(!1),d({processing:!1,password:"",error:""})}return r("span",{children:[e("span",{onClick:w,children:l}),r(T,{isOpen:x,onClose:u,children:[r(T.Content,{title:b,children:[N,r("div",{className:"mt-4",children:[e(_,{ref:t,type:"password",className:"mt-1 block w-3/4",placeholder:"Password",value:o.password,onChange:n=>d({...o,password:n.currentTarget.value})}),e(I,{message:o.error,className:"mt-2"})]})]}),r(T.Footer,{children:[e(C,{onClick:u,children:"Cancel"}),e(F,{className:y("ml-2",{"opacity-25":o.processing}),onClick:v,disabled:o.processing,children:c})]})]})]})}function ae({requiresConfirmation:b}){var R,k,A;const N=H(),[c,p]=i.exports.useState(!1),[l,f]=i.exports.useState(!1),[x,g]=i.exports.useState(null),[o,d]=i.exports.useState([]),[t,w]=i.exports.useState(!1),[v,u]=i.exports.useState(null),n=j({code:""}),s=!c&&((A=(k=(R=N.props)==null?void 0:R.auth)==null?void 0:k.user)==null?void 0:A.two_factor_enabled);function K(){p(!0),D.post("/user/two-factor-authentication",{},{preserveScroll:!0,onSuccess(){return Promise.all([E(),M(),S()])},onFinish(){p(!1),w(b)}})}function M(){return h.get("/user/two-factor-secret-key").then(a=>{u(a.data.secretKey)})}function B(){n.post("/user/confirmed-two-factor-authentication",{preserveScroll:!0,preserveState:!0,errorBag:"confirmTwoFactorAuthentication",onSuccess:()=>{w(!1),g(null),u(null)}})}function E(){return h.get("/user/two-factor-qr-code").then(a=>{g(a.data.svg)})}function S(){return h.get("/user/two-factor-recovery-codes").then(a=>{d(a.data)})}function O(){h.post("/user/two-factor-recovery-codes").then(()=>{S()})}function P(){f(!0),D.delete("/user/two-factor-authentication",{preserveScroll:!0,onSuccess(){f(!1),w(!1)}})}return r(L,{title:"Two Factor Authentication",description:"Add additional security to your account using two factor authentication.",children:[(()=>s&&!t?e("h3",{className:"text-lg font-medium text-gray-900",children:"You have enabled two factor authentication."}):t?e("h3",{className:"text-lg font-medium text-gray-900",children:"Finish enabling two factor authentication."}):e("h3",{className:"text-lg font-medium text-gray-900",children:"You have not enabled two factor authentication."}))(),e("div",{className:"mt-3 max-w-xl text-sm text-gray-600",children:e("p",{children:"When two factor authentication is enabled, you will be prompted for a secure, random token during authentication. You may retrieve this token from your phone's Google Authenticator application."})}),s||t?r("div",{children:[x?r("div",{children:[e("div",{className:"mt-4 max-w-xl text-sm text-gray-600",children:t?e("p",{className:"font-semibold",children:"To finish enabling two factor authentication, scan the following QR code using your phone's authenticator application or enter the setup key and provide the generated OTP code."}):e("p",{children:"Two factor authentication is now enabled. Scan the following QR code using your phone's authenticator application or enter the setup key."})}),e("div",{className:"mt-4",dangerouslySetInnerHTML:{__html:x||""}}),v&&e("div",{className:"mt-4 max-w-xl text-sm text-gray-600",children:r("p",{className:"font-semibold",children:["Setup Key:"," ",e("span",{dangerouslySetInnerHTML:{__html:v||""}})]})}),t&&r("div",{className:"mt-4",children:[e(q,{htmlFor:"code",value:"Code"}),e(_,{id:"code",type:"text",name:"code",className:"block mt-1 w-1/2",inputMode:"numeric",autoFocus:!0,autoComplete:"one-time-code",value:n.data.code,onChange:a=>n.setData("code",a.currentTarget.value)}),e(I,{message:n.errors.code,className:"mt-2"})]})]}):null,o.length>0&&!t?r("div",{children:[e("div",{className:"mt-4 max-w-xl text-sm text-gray-600",children:e("p",{className:"font-semibold",children:"Store these recovery codes in a secure password manager. They can be used to recover access to your account if your two factor authentication device is lost."})}),e("div",{className:"grid gap-1 max-w-xl mt-4 px-4 py-4 font-mono text-sm bg-gray-100 rounded-lg",children:o.map(a=>e("div",{children:a},a))})]}):null]}):null,e("div",{className:"mt-5",children:s||t?r("div",{children:[t?e(m,{onConfirm:B,children:e(F,{className:y("mr-3",{"opacity-25":c}),disabled:c,children:"Confirm"})}):null,o.length>0&&!t?e(m,{onConfirm:O,children:e(C,{className:"mr-3",children:"Regenerate Recovery Codes"})}):null,o.length===0&&!t?e(m,{onConfirm:S,children:e(C,{className:"mr-3",children:"Show Recovery Codes"})}):null,t?e(m,{onConfirm:P,children:e(C,{className:y("mr-3",{"opacity-25":l}),disabled:l,children:"Cancel"})}):e(m,{onConfirm:P,children:e(Y,{className:y({"opacity-25":l}),disabled:l,children:"Disable"})})]}):e("div",{children:e(m,{onConfirm:K,children:e(F,{type:"button",className:y({"opacity-25":c}),disabled:c,children:"Enable"})})})})]})}export{ae as default};
